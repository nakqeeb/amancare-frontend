<!-- src/app/public/components/quick-booking-widget/quick-booking-widget.component.html -->

<mat-card class="quick-booking-widget">
  <mat-card-header>
    <mat-card-title>
      <mat-icon>flash_on</mat-icon>
      حجز سريع
    </mat-card-title>
  </mat-card-header>

  <mat-card-content>
    <form [formGroup]="quickBookingForm">
      <!-- Clinic Selection -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>اختر العيادة</mat-label>
        <mat-select formControlName="clinicId" required>
          <mat-option>-- اختر العيادة --</mat-option>
          @for (clinic of clinics(); track clinic.id) {
          <mat-option [value]="clinic.id">
            {{ clinic.name }}
          </mat-option>
          }
        </mat-select>
        <mat-icon matPrefix>local_hospital</mat-icon>
      </mat-form-field>

      <!-- Doctor Selection (Optional) -->
      @if (quickBookingForm.get('clinicId')?.value) {
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>اختر الطبيب (اختياري)</mat-label>
        <mat-select formControlName="doctorId">
          <mat-option value="">-- جميع الأطباء --</mat-option>
          @for (doctor of doctors(); track doctor.doctorId) {
          <mat-option [value]="doctor.doctorId">
            {{ doctor.fullName }}
            @if (doctor.specialization) { - {{ doctor.specialization }}
            }
          </mat-option>
          }
        </mat-select>
        <mat-icon matPrefix>person</mat-icon>
      </mat-form-field>
      }

      <!-- Date Selection (Optional) -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>التاريخ المفضل (اختياري)</mat-label>
        <input
          matInput
          [matDatepicker]="picker"
          formControlName="appointmentDate"
          [min]="minDate"
        />
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
        <mat-icon matPrefix>calendar_today</mat-icon>
      </mat-form-field>

      @if (loading()) {
      <div class="loading-indicator">
        <mat-spinner diameter="30"></mat-spinner>
        <span>جارٍ التحميل...</span>
      </div>
      }
    </form>
  </mat-card-content>

  <mat-card-actions>
    <button
      mat-raised-button
      color="primary"
      (click)="onQuickBook()"
      [disabled]="quickBookingForm.get('clinicId')?.invalid"
      class="book-button"
    >
      <mat-icon>arrow_back</mat-icon>
      متابعة الحجز
    </button>
  </mat-card-actions>
</mat-card>
