<!-- ===================================================================
     Main Dashboard Component - Complete Template
     src/app/features/dashboard/components/main-dashboard/main-dashboard.component.html
     =================================================================== -->

<app-header></app-header>

<app-sidebar>
  <div class="dashboard-container">
    <!-- Welcome Header -->
    <div class="context-indicator">
      <app-system-admin-context-indicator />
    </div>
    <div class="dashboard-header">
      <div class="welcome-section">
        <h1 class="welcome-title">
          {{ greeting() }}، {{ userName() }} ({{
            getRoleDisplayName(currentUser()?.role)
          }})
        </h1>
        <p class="welcome-subtitle">
          مرحباً بك في لوحة التحكم الخاصة بنظام أمان كير
        </p>
        <div class="date-time">
          <mat-icon>calendar_today</mat-icon>
          <span>{{ currentHijriDate() }}</span>
          <mat-icon>schedule</mat-icon>
          <span>{{ currentTime() }}</span>
        </div>
        <div class="date-time">
          <mat-icon>calendar_today</mat-icon>
          <span>الموافق {{ currentGregorianDate() }}</span>
        </div>
      </div>

      <div class="header-actions">
        <button
          mat-raised-button
          color="primary"
          (click)="refreshData()"
          [disabled]="loadingStats()"
        >
          <mat-icon>refresh</mat-icon>
          تحديث البيانات
        </button>
        <button mat-stroked-button [matMenuTriggerFor]="menu">
          <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item (click)="exportDashboard()">
            <mat-icon>download</mat-icon>
            تصدير التقرير
          </button>
          <button mat-menu-item routerLink="/settings">
            <mat-icon>settings</mat-icon>
            الإعدادات
          </button>
        </mat-menu>
      </div>
    </div>

    <!-- Loading State -->
    @if (loadingStats()) {
    <div class="loading-overlay">
      <mat-spinner diameter="50"></mat-spinner>
      <p>جاري تحميل البيانات...</p>
    </div>
    }

    <!-- Statistics Cards Grid -->
    @if (!loadingStats() && patientStats()) {
    <div class="stats-cards-grid">
      @for (card of statsCards(); track card.title) {
      <mat-card class="stat-card" [class]="'card-' + card.color">
        <mat-card-content>
          <div class="card-icon">
            <mat-icon>{{ card.icon }}</mat-icon>
          </div>
          <div class="card-info">
            <h3 class="card-value">{{ formatNumber(+card.value) }}</h3>
            <p class="card-title">{{ card.title }}</p>
            @if (card.subtitle) {
            <p class="card-subtitle">{{ card.subtitle }}</p>
            } @if (card.trend) {
            <div
              class="card-trend"
              [class.positive]="card.trend > 0"
              [class.negative]="card.trend < 0"
            >
              <mat-icon>{{
                card.trend > 0 ? "trending_up" : "trending_down"
              }}</mat-icon>
              <span>{{ formatPercentage(card.trend) }}</span>
            </div>
            }
          </div>
        </mat-card-content>
      </mat-card>
      }
    </div>
    }

    <!-- Quick Actions -->
    <div class="quick-actions-section">
      <h2 class="section-title">
        <mat-icon>flash_on</mat-icon>
        الإجراءات السريعة
      </h2>
      <div class="quick-actions-grid">
        @for (action of quickActions; track action.label) {
        <button
          mat-raised-button
          [color]="action.color"
          [routerLink]="action.route"
          class="quick-action-btn"
        >
          <mat-icon>{{ action.icon }}</mat-icon>
          <span>{{ action.label }}</span>
        </button>
        }
      </div>
    </div>

    <!-- Main Content Grid -->
    <div class="content-grid">
      <!-- Gender Distribution Card -->
      @if (genderData()) {
      <mat-card class="gender-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>wc</mat-icon>
            توزيع المرضى حسب الجنس
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="gender-stats">
            <div class="gender-item male">
              <mat-icon>male</mat-icon>
              <div class="gender-info">
                <span class="gender-label">ذكور</span>
                <span class="gender-count">{{ genderData()!.male.count }}</span>
                <span class="gender-percentage">{{
                  formatPercentage(genderData()!.male.percentage)
                }}</span>
              </div>
            </div>
            <div class="gender-divider"></div>
            <div class="gender-item female">
              <mat-icon>female</mat-icon>
              <div class="gender-info">
                <span class="gender-label">إناث</span>
                <span class="gender-count">{{
                  genderData()!.female.count
                }}</span>
                <span class="gender-percentage">{{
                  formatPercentage(genderData()!.female.percentage)
                }}</span>
              </div>
            </div>
          </div>
          <div class="gender-bar">
            <div
              class="male-bar"
              [style.width.%]="genderData()!.male.percentage"
            ></div>
            <div
              class="female-bar"
              [style.width.%]="genderData()!.female.percentage"
            ></div>
          </div>
        </mat-card-content>
      </mat-card>
      }

      <!-- Today's Appointments -->
      <mat-card class="appointments-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>event</mat-icon>
            مواعيد اليوم
          </mat-card-title>
          <button mat-icon-button routerLink="/appointments/today">
            <mat-icon>arrow_forward</mat-icon>
          </button>
        </mat-card-header>
        <mat-card-content>
          @if (todayAppointments().length > 0) {
          <div class="appointments-list">
            @for (appointment of todayAppointments().slice(0, 5); track
            appointment.id) {
            <div class="appointment-item">
              <div class="appointment-time">
                <mat-icon>schedule</mat-icon>
                <span>{{ appointment.appointmentTime }}</span>
              </div>
              <div class="appointment-info">
                <p class="patient-name">{{ appointment.patientName }}</p>
                <p class="appointment-type">
                  {{ appointment.appointmentType }}
                </p>
              </div>
              <mat-chip [class]="'status-' + appointment.status">
                {{ getStatusLabel(appointment.status) }}
              </mat-chip>
            </div>
            } @if (todayAppointments().length > 5) {
            <div class="show-more">
              <button mat-button routerLink="/appointments/today">
                عرض الكل ({{ todayAppointments().length }})
              </button>
            </div>
            }
          </div>
          } @else {
          <div class="empty-state">
            <mat-icon>event_busy</mat-icon>
            <p>لا توجد مواعيد لهذا اليوم</p>
          </div>
          }
        </mat-card-content>
      </mat-card>

      <!-- Patient Statistics Summary -->
      @if (patientStats()) {
      <mat-card class="summary-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>insights</mat-icon>
            ملخص الإحصائيات
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="summary-grid">
            <div class="summary-item">
              <span class="summary-label">إجمالي المرضى</span>
              <span class="summary-value">{{
                patientStats()!.totalPatients
              }}</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">المرضى النشطون</span>
              <span class="summary-value success">{{
                patientStats()!.activePatients
              }}</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">غير النشطين</span>
              <span class="summary-value warn">{{
                patientStats()!.inactivePatients
              }}</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">مرضى جدد</span>
              <span class="summary-value info">{{
                patientStats()!.newPatientsThisMonth
              }}</span>
            </div>
            @if (patientStats()!.averageAge) {
            <div class="summary-item">
              <span class="summary-label">متوسط العمر</span>
              <span class="summary-value"
                >{{ formatNumber(patientStats()!.averageAge!) }} سنة</span
              >
            </div>
            } @if (patientStats()!.totalOutstandingBalance &&
            patientStats()!.totalOutstandingBalance! > 0) {
            <div class="summary-item">
              <span class="summary-label">المبالغ المستحقة</span>
              <span class="summary-value error">{{
                formatCurrency(patientStats()!.totalOutstandingBalance!)
              }}</span>
            </div>
            }
          </div>
        </mat-card-content>
        <mat-card-actions>
          <button mat-button color="primary" routerLink="/patients">
            <mat-icon>people</mat-icon>
            عرض جميع المرضى
          </button>
          <button mat-button routerLink="/reports">
            <mat-icon>assessment</mat-icon>
            التقارير المفصلة
          </button>
        </mat-card-actions>
      </mat-card>
      }
    </div>

    <!-- Activity Feed -->
    <!-- <mat-card class="activity-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>history</mat-icon>
          النشاطات الأخيرة
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="activity-list">
          <div class="activity-item">
            <mat-icon class="activity-icon success">person_add</mat-icon>
            <div class="activity-info">
              <p class="activity-text">تم إضافة مريض جديد</p>
              <p class="activity-time">قبل 5 دقائق</p>
            </div>
          </div>
          <div class="activity-item">
            <mat-icon class="activity-icon info">event_available</mat-icon>
            <div class="activity-info">
              <p class="activity-text">تم تأكيد موعد</p>
              <p class="activity-time">قبل 15 دقيقة</p>
            </div>
          </div>
          <div class="activity-item">
            <mat-icon class="activity-icon accent">receipt</mat-icon>
            <div class="activity-info">
              <p class="activity-text">تم إصدار فاتورة جديدة</p>
              <p class="activity-time">قبل 30 دقيقة</p>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card> -->
    <!-- Activity Feed Component Integration -->
    <mat-card class="activity-card">
      <!-- <app-activity-feed
        [limit]="10"
        [showHeader]="true"
        [showFilters]="true"
        [compact]="false"
        [refreshInterval]="30"
      >
      </app-activity-feed> -->
      <app-recent-activities />
    </mat-card>
  </div>
</app-sidebar>
