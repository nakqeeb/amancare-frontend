// ===================================================================
// src/app/features/invoices/components/invoice-preview/invoice-preview.component.scss
// ===================================================================

.invoice-preview-container {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  background-color: #f5f5f5;

  &.fullscreen {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 1000;
    background-color: white;

    .preview-header {
      position: relative;
      z-index: 1001;
    }

    .invoice-content {
      flex: 1;
      overflow: auto;
      padding: 20px;
    }
  }

  .preview-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 100;
    background-color: white;
    border-bottom: 1px solid #e0e0e0;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 20px;
      // margin-top: 64px; // Account for app header
      // margin-right: 240px; // Account for sidebar

      @media (max-width: 768px) {
        margin-right: 0;
        margin-top: 56px;
        padding: 12px 16px;
        flex-direction: column;
        gap: 12px;
      }

      .title-section {
        display: flex;
        align-items: center;
        gap: 16px;

        .back-button {
          color: #666;
        }

        .title-info {
          .page-title {
            margin: 0;
            font-size: 20px;
            font-weight: 600;
            color: #333;
          }

          .page-subtitle {
            margin: 4px 0 0;
            font-size: 14px;
            color: #666;
          }
        }
      }

      .header-actions {
        display: flex;
        gap: 12px;
        align-items: center;

        @media (max-width: 768px) {
          width: 100%;
          justify-content: center;
        }

        button {
          min-width: 100px;

          @media (max-width: 480px) {
            min-width: 80px;
            font-size: 12px;
          }
        }
      }
    }
  }

  .loading-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 80px 20px;
    margin-top: 120px;

    mat-spinner {
      margin-bottom: 20px;
    }

    p {
      color: #666;
      font-size: 16px;
    }
  }

  .invoice-content {
    flex: 1;
    max-width: 210mm; // A4 width
    margin: 140px auto 40px; // Top margin for header
    background-color: white;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    padding: 40px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    line-height: 1.6;

    @media (max-width: 768px) {
      margin: 180px 16px 20px;
      padding: 20px;
      box-shadow: none;
    }

    .company-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 40px;
      padding-bottom: 20px;
      border-bottom: 3px solid #1976d2;

      .company-info {
        display: flex;
        align-items: flex-start;
        gap: 20px;

        .company-logo {
          .logo-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: #1976d2;
            color: white;

            mat-icon {
              font-size: 40px;
              width: 40px;
              height: 40px;
            }
          }
        }

        .company-details {
          .company-name {
            margin: 0 0 4px;
            font-size: 28px;
            font-weight: 700;
            color: #1976d2;
          }

          .company-name-en {
            margin: 0 0 16px;
            font-size: 16px;
            font-weight: 400;
            color: #666;
            font-style: italic;
          }

          .company-contact {
            .contact-item {
              display: flex;
              align-items: center;
              gap: 8px;
              margin-bottom: 4px;
              font-size: 14px;
              color: #666;

              mat-icon {
                font-size: 16px;
                width: 16px;
                height: 16px;
                color: #1976d2;
              }
            }
          }
        }
      }

      .invoice-header-info {
        text-align: right;

        .invoice-title {
          margin: 0 0 20px;
          font-size: 24px;
          font-weight: 700;
          color: #1976d2;
          text-align: center;
          line-height: 1.3;

          .invoice-title-en {
            font-size: 18px;
            color: #666;
            font-weight: 400;
          }
        }

        .invoice-meta {
          .meta-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;

            .label {
              font-weight: 600;
              color: #333;
              min-width: 100px;
            }

            .value {
              color: #666;
            }
          }
        }
      }
    }

    .patient-section {
      margin-bottom: 30px;

      .section-title {
        margin-bottom: 16px;
        padding-bottom: 8px;
        border-bottom: 2px solid #e0e0e0;

        h3 {
          margin: 0;
          font-size: 18px;
          font-weight: 600;
          color: #1976d2;
        }

        .section-title-en {
          font-size: 14px;
          color: #666;
          font-weight: 400;
        }
      }

      .patient-info {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;

        .patient-details {
          flex: 1;

          .info-row {
            display: flex;
            margin-bottom: 8px;
            font-size: 14px;

            .label {
              font-weight: 600;
              color: #333;
              min-width: 80px;
            }

            .value {
              color: #666;
            }
          }
        }

        .invoice-status {
          .status-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;

            &.paid {
              background-color: #e8f5e8;
              color: #2e7d2e;
            }

            &.pending {
              background-color: #fff3cd;
              color: #856404;
            }

            &.overdue {
              background-color: #f8d7da;
              color: #721c24;
            }
          }
        }
      }
    }

    .services-section {
      margin-bottom: 30px;

      .section-title {
        margin-bottom: 16px;
        padding-bottom: 8px;
        border-bottom: 2px solid #e0e0e0;

        h3 {
          margin: 0;
          font-size: 18px;
          font-weight: 600;
          color: #1976d2;
        }

        .section-title-en {
          font-size: 14px;
          color: #666;
          font-weight: 400;
        }
      }

      .services-table {
        width: 100%;
        border-collapse: collapse;
        border: 2px solid #e0e0e0;

        thead {
          background-color: #f5f5f5;

          th {
            padding: 12px;
            text-align: center;
            font-weight: 600;
            color: #333;
            border: 1px solid #e0e0e0;
            font-size: 14px;

            &.service-name {
              text-align: right;
              width: 40%;
            }

            &.quantity {
              width: 15%;
            }

            &.unit-price {
              width: 20%;
            }

            &.total-price {
              width: 25%;
            }
          }
        }

        tbody {
          tr {
            &:nth-child(even) {
              background-color: #fafafa;
            }

            td {
              padding: 12px;
              border: 1px solid #e0e0e0;
              font-size: 14px;

              &.service-name {
                text-align: right;
                vertical-align: top;

                .service-details {
                  .service-name-ar {
                    font-weight: 600;
                    color: #333;
                    margin-bottom: 4px;
                  }

                  .service-description {
                    font-size: 12px;
                    color: #666;
                    margin-bottom: 4px;
                  }

                  .service-category {
                    font-size: 11px;
                    color: #999;
                    font-style: italic;
                  }
                }
              }

              &.quantity {
                text-align: center;
                font-weight: 600;
              }

              &.unit-price,
              &.total-price {
                text-align: right;
                font-weight: 600;
                color: #333;
              }
            }
          }
        }
      }
    }

    .summary-section {
      margin-bottom: 30px;

      .summary-content {
        display: grid;
        grid-template-columns: 1fr 300px;
        gap: 30px;

        @media (max-width: 768px) {
          grid-template-columns: 1fr;
          gap: 20px;
        }

        .summary-left {

          .amount-in-words,
          .payment-terms {
            margin-bottom: 20px;

            .section-title {
              margin-bottom: 8px;

              h4 {
                margin: 0;
                font-size: 14px;
                font-weight: 600;
                color: #1976d2;
              }

              .section-title-en {
                font-size: 12px;
                color: #666;
                font-weight: 400;
              }
            }

            .words-content,
            .terms-content {
              font-size: 13px;
              color: #666;
              line-height: 1.5;
              padding: 12px;
              background-color: #f9f9f9;
              border-radius: 4px;
              border-right: 4px solid #1976d2;
            }
          }
        }

        .summary-right {
          .calculation-table {
            background-color: #f9f9f9;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;

            .calculation-row {
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 8px;
              font-size: 14px;

              &.discount {
                color: #2e7d2e;
              }

              &.total {
                font-size: 16px;
                font-weight: 700;
                color: #1976d2;
                padding: 8px 0;
                margin: 8px 0;
              }

              &.paid {
                color: #2e7d2e;
              }

              &.remaining {
                color: #d32f2f;
                font-weight: 600;
              }

              .label {
                font-weight: 600;
              }

              .value {
                font-weight: 600;
                text-align: right;
              }
            }

            .calculation-divider {
              height: 2px;
              background-color: #1976d2;
              margin: 12px 0;
            }
          }
        }
      }
    }

    .notes-section {
      margin-bottom: 30px;

      .section-title {
        margin-bottom: 12px;

        h4 {
          margin: 0;
          font-size: 16px;
          font-weight: 600;
          color: #1976d2;
        }

        .section-title-en {
          font-size: 14px;
          color: #666;
          font-weight: 400;
        }
      }

      .notes-content {
        font-size: 14px;
        color: #666;
        line-height: 1.6;
        padding: 16px;
        background-color: #f9f9f9;
        border-radius: 4px;
        border-right: 4px solid #ff9800;
      }
    }

    .invoice-footer {
      margin-top: 40px;
      border-top: 2px solid #e0e0e0;
      padding-top: 20px;

      .footer-content {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 20px;

        .footer-left {
          .tax-info {
            .tax-item {
              display: flex;
              margin-bottom: 4px;
              font-size: 12px;

              .label {
                font-weight: 600;
                color: #333;
                min-width: 120px;
              }

              .value {
                color: #666;
              }
            }
          }
        }

        .footer-right {
          .signature-section {
            text-align: center;

            .signature-box {
              width: 200px;

              .signature-line {
                height: 60px;
                border-bottom: 1px solid #333;
                margin-bottom: 8px;
              }

              .signature-label {
                font-size: 12px;
                color: #666;
                font-weight: 600;
              }
            }
          }
        }
      }

      .footer-bottom {
        text-align: center;
        padding-top: 16px;
        border-top: 1px solid #e0e0e0;

        .company-contact-footer {
          font-size: 12px;
          color: #666;

          span {
            margin: 0 8px;
          }
        }
      }
    }

    .qr-section {
      margin-top: 30px;
      text-align: center;
      padding: 20px;
      background-color: #f9f9f9;
      border-radius: 8px;

      .qr-placeholder {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        color: #666;

        mat-icon {
          font-size: 48px;
          width: 48px;
          height: 48px;
        }

        span {
          font-size: 12px;
          font-weight: 600;
        }
      }
    }
  }

  .error-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 80px 20px;
    text-align: center;
    margin-top: 120px;

    .error-icon {
      font-size: 64px;
      width: 64px;
      height: 64px;
      color: #f44336;
      margin-bottom: 20px;
    }

    h3 {
      margin: 0 0 12px;
      color: #666;
      font-weight: 500;
    }

    p {
      margin: 0 0 24px;
      color: #999;
      max-width: 400px;
    }
  }
}

// Print Styles
@media print {
  .invoice-preview-container {
    background-color: white !important;

    .no-print {
      display: none !important;
    }

    .invoice-content {
      margin: 0 !important;
      box-shadow: none !important;
      padding: 20mm !important;
      max-width: none !important;
    }

    .company-header {
      .company-info .company-logo .logo-placeholder {
        -webkit-print-color-adjust: exact;
        color-adjust: exact;
      }
    }

    .services-section .services-table {
      thead {
        -webkit-print-color-adjust: exact;
        color-adjust: exact;
      }
    }

    .summary-section .summary-content .summary-right .calculation-table {
      -webkit-print-color-adjust: exact;
      color-adjust: exact;
    }
  }
}

// Responsive Design
@media (max-width: 768px) {
  .invoice-preview-container {
    .invoice-content {
      .company-header {
        flex-direction: column;
        gap: 20px;
        text-align: center;

        .company-info {
          justify-content: center;
        }

        .invoice-header-info {
          text-align: center;
        }
      }

      .patient-section .patient-info {
        flex-direction: column;
        gap: 16px;

        .invoice-status {
          align-self: flex-start;
        }
      }

      .services-section .services-table {
        font-size: 12px;

        thead th,
        tbody td {
          padding: 8px 4px;
        }
      }

      .invoice-footer .footer-content {
        flex-direction: column;
        gap: 20px;
        text-align: center;
      }
    }
  }
}

@media (max-width: 480px) {
  .invoice-preview-container {
    .invoice-content {
      padding: 16px;

      .company-header {
        .company-info {
          flex-direction: column;
          align-items: center;
          text-align: center;
        }

        .invoice-header-info .invoice-title {
          font-size: 20px;
        }
      }

      .services-section .services-table {
        .service-name {
          width: 50% !important;
        }

        .quantity {
          width: 10% !important;
        }

        .unit-price,
        .total-price {
          width: 20% !important;
        }
      }
    }
  }
}

// RTL Support
[dir="rtl"] {
  .invoice-preview-container {
    .preview-header .header-content {
      margin-right: 0;
      margin-left: 240px;

      @media (max-width: 768px) {
        margin-left: 0;
      }
    }

    .invoice-content {
      .company-header {
        .company-info {
          flex-direction: row-reverse;
        }

        .invoice-header-info {
          text-align: left;
        }
      }

      .services-section .services-table {

        thead th.service-name,
        tbody td.service-name {
          text-align: left;
        }

        tbody td.unit-price,
        tbody td.total-price {
          text-align: left;
        }
      }

      .summary-section .summary-content .summary-right .calculation-table .calculation-row .value {
        text-align: left;
      }
    }
  }
}

// Animation for fullscreen toggle
.invoice-preview-container {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

// Hover effects for interactive elements
.patient-info {
  cursor: pointer;
  transition: background-color 0.2s ease;

  &:hover {
    background-color: #f5f5f5;
  }
}
