<div class="appointments-container">
  <app-header></app-header>
  <app-sidebar></app-sidebar>

  <main class="main-content">
    <!-- Page Header -->
    <div class="page-header">
      <div class="header-content">
        <h1>إدارة المواعيد</h1>
        <p class="subtitle">عرض وإدارة جميع المواعيد الطبية</p>
      </div>
      <div class="header-actions">
        <button
          mat-raised-button
          color="primary"
          routerLink="/appointments/new"
          class="add-btn"
        >
          <mat-icon>add</mat-icon>
          حجز موعد جديد
        </button>
        <button
          mat-stroked-button
          routerLink="/appointments/calendar"
          class="calendar-btn"
        >
          <mat-icon>calendar_month</mat-icon>
          عرض التقويم
        </button>
      </div>
    </div>

    <!-- Statistics Cards -->
    <div class="stats-row">
      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-icon scheduled">
            <mat-icon>event</mat-icon>
          </div>
          <div class="stat-info">
            <span class="stat-value">{{ getTodayCount("SCHEDULED") }}</span>
            <span class="stat-label">مواعيد مجدولة</span>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-icon confirmed">
            <mat-icon>check_circle</mat-icon>
          </div>
          <div class="stat-info">
            <span class="stat-value">{{ getTodayCount("CONFIRMED") }}</span>
            <span class="stat-label">مواعيد مؤكدة</span>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-icon in-progress">
            <mat-icon>pending</mat-icon>
          </div>
          <div class="stat-info">
            <span class="stat-value">{{ getTodayCount("IN_PROGRESS") }}</span>
            <span class="stat-label">قيد التنفيذ</span>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-icon completed">
            <mat-icon>task_alt</mat-icon>
          </div>
          <div class="stat-info">
            <span class="stat-value">{{ getTodayCount("COMPLETED") }}</span>
            <span class="stat-label">مكتملة اليوم</span>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Filters Card -->
    <mat-card class="filters-card">
      <mat-card-header>
        <mat-card-title>تصفية المواعيد</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <form [formGroup]="filterForm" class="filter-form">
          <div class="filter-row">
            <!-- Date Range -->
            <mat-form-field appearance="outline">
              <mat-label>من تاريخ</mat-label>
              <input
                matInput
                [matDatepicker]="fromPicker"
                formControlName="fromDate"
              />
              <mat-datepicker-toggle
                matSuffix
                [for]="fromPicker"
              ></mat-datepicker-toggle>
              <mat-datepicker #fromPicker></mat-datepicker>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>إلى تاريخ</mat-label>
              <input
                matInput
                [matDatepicker]="toPicker"
                formControlName="toDate"
              />
              <mat-datepicker-toggle
                matSuffix
                [for]="toPicker"
              ></mat-datepicker-toggle>
              <mat-datepicker #toPicker></mat-datepicker>
            </mat-form-field>

            <!-- Status Filter -->
            <mat-form-field appearance="outline">
              <mat-label>الحالة</mat-label>
              <mat-select formControlName="status">
                @for (status of statusOptions; track status.value) {
                <mat-option [value]="status.value">{{
                  status.label
                }}</mat-option>
                }
              </mat-select>
            </mat-form-field>

            <!-- Type Filter -->
            <mat-form-field appearance="outline">
              <mat-label>نوع الموعد</mat-label>
              <mat-select formControlName="type">
                @for (type of typeOptions; track type.value) {
                <mat-option [value]="type.value">{{ type.label }}</mat-option>
                }
              </mat-select>
            </mat-form-field>

            <!-- Search -->
            <mat-form-field appearance="outline" class="search-field">
              <mat-label>البحث</mat-label>
              <input
                matInput
                formControlName="searchQuery"
                placeholder="اسم المريض أو الطبيب..."
              />
              <mat-icon matSuffix>search</mat-icon>
            </mat-form-field>

            <!-- Reset Button -->
            <button
              mat-stroked-button
              type="button"
              (click)="onResetFilters()"
              class="reset-btn"
            >
              <mat-icon>clear</mat-icon>
              مسح الفلاتر
            </button>
          </div>
        </form>
      </mat-card-content>
    </mat-card>

    <!-- Appointments Table -->
    <mat-card class="table-card">
      <mat-card-header>
        <mat-card-title>
          قائمة المواعيد
          <span class="count-badge">{{ totalAppointments() }}</span>
        </mat-card-title>
        <div class="table-actions">
          <button mat-icon-button (click)="onRefresh()">
            <mat-icon>refresh</mat-icon>
          </button>
          <button mat-icon-button [matMenuTriggerFor]="exportMenu">
            <mat-icon>download</mat-icon>
          </button>
          <mat-menu #exportMenu="matMenu">
            <button mat-menu-item (click)="onExport({ format: 'excel' })">
              <mat-icon>table_chart</mat-icon>
              تصدير Excel
            </button>
            <button mat-menu-item (click)="onExport({ format: 'pdf' })">
              <mat-icon>picture_as_pdf</mat-icon>
              تصدير PDF
            </button>
          </mat-menu>
        </div>
      </mat-card-header>

      <mat-card-content>
        <!-- <app-data-table
          #dataTable
          [data]="appointments()"
          [columns]="columns"
          [actions]="actions"
          [loading]="loading()"
          [pageSize]="10"
          [pageSizeOptions]="[5, 10, 25, 50]"
          [showCheckbox]="true"
          [showPagination]="true"
          [showFilter]="false"
          [emptyMessage]="'لا توجد مواعيد'"
          [rowClass]="getRowClass"
          (refresh)="onRefresh()"
          (bulkAction)="onBulkAction($event)"
        ></app-data-table> -->
        <app-data-table
          #dataTable
          [columns]="columns"
          [actions]="actions"
          [selectable]="true"
          [showPaginator]="true"
          [pageSizeOptions]="[5, 10, 25, 50]"
          [emptyMessage]="'لا توجد مواعيد'"
          (refresh)="onRefresh()"
          (bulkDelete)="onBulkDelete($event)"
        ></app-data-table>
      </mat-card-content>
    </mat-card>
  </main>
</div>
